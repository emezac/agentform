<%# Template Card Component with Payment Preview Integration %>
<% 
  # Extract payment requirements from template
  has_payment_questions = template.has_payment_questions?
  required_features = template.required_features
%>

<div class="bg-white rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-all duration-200 group"
     data-controller="template-preview"
     data-template-preview-template-id-value="<%= template.id %>"
     data-template-preview-has-payment-questions-value="<%= has_payment_questions %>"
     data-template-preview-required-features-value="<%= required_features.to_json %>"
     data-template-id="<%= template.id %>">
  
  <!-- Template Header -->
  <div class="p-6">
    <div class="flex items-start justify-between mb-4">
      <div class="flex items-center space-x-3">
        <!-- Template Icon -->
        <div class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-lg flex items-center justify-center">
          <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
            <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
          </svg>
        </div>
        
        <!-- Template Info -->
        <div class="flex-1">
          <h3 class="text-lg font-semibold text-gray-900 group-hover:text-purple-600 transition-colors">
            <%= template.name %>
          </h3>
          <p class="text-sm text-gray-600 mt-1">
            <%= template.description %>
          </p>
        </div>
      </div>

      <!-- Payment Badge -->
      <%= render 'shared/payment_badge', 
          has_payment_questions: has_payment_questions,
          required_features: required_features,
          size: 'md' %>
    </div>

    <!-- Template Metadata -->
    <div class="flex items-center justify-between text-sm text-gray-500 mb-4">
      <div class="flex items-center space-x-4">
        <span class="flex items-center">
          <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
          </svg>
          <%= template.estimated_time_minutes %> min
        </span>
        
        <span class="flex items-center">
          <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <%= template.usage_count %> uses
        </span>
      </div>

      <span class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium">
        <%= template.category.humanize %>
      </span>
    </div>

    <!-- Template Features and Payment Info -->
    <div class="space-y-3 mb-4">
      <!-- Features -->
      <div class="flex flex-wrap gap-2">
        <% template.features_list.first(3).each do |feature| %>
          <span class="inline-flex items-center px-2 py-1 bg-blue-50 text-blue-700 text-xs font-medium rounded-md">
            <%= feature.humanize %>
          </span>
        <% end %>
        
        <% if template.features_list.length > 3 %>
          <span class="inline-flex items-center px-2 py-1 bg-gray-50 text-gray-600 text-xs font-medium rounded-md">
            +<%= template.features_list.length - 3 %> more
          </span>
        <% end %>
      </div>

      <!-- Payment Requirements Details -->
      <% if has_payment_questions %>
        <div class="p-3 bg-purple-50 rounded-lg border border-purple-200">
          <div class="flex items-start justify-between">
            <div class="flex-1">
              <h4 class="text-xs font-medium text-purple-900 mb-1">Payment Setup Required</h4>
              <div class="space-y-1">
                <% required_features.each do |feature| %>
                  <div class="flex items-center text-xs text-purple-700">
                    <svg class="w-3 h-3 mr-1.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    <%= feature.humanize %>
                  </div>
                <% end %>
              </div>
            </div>
            <div class="flex-shrink-0 ml-2">
              <span class="inline-flex items-center px-2 py-1 bg-purple-100 text-purple-800 text-xs font-medium rounded-full">
                <%= template.setup_complexity.humanize %>
              </span>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Action Buttons -->
    <div class="flex space-x-3">
      <%= link_to template_path(template), 
          class: "flex-1 inline-flex justify-center items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors" do %>
        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
          <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path>
          <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"></path>
        </svg>
        Preview
      <% end %>
      
      <% if has_payment_questions %>
        <button class="flex-1 inline-flex justify-center items-center px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-purple-600 to-indigo-600 border border-transparent rounded-lg hover:from-purple-700 hover:to-indigo-700 transition-all duration-200"
                data-action="click->template-preview#showPaymentRequirements">
          <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
          </svg>
          Use This Template
        </button>
      <% else %>
        <%= link_to instantiate_template_path(template), 
            data: { turbo_method: :post },
            class: "flex-1 inline-flex justify-center items-center px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-purple-600 to-indigo-600 border border-transparent rounded-lg hover:from-purple-700 hover:to-indigo-700 transition-all duration-200" do %>
          <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
          </svg>
          Use This Template
        <% end %>
      <% end %>
    </div>
  </div>

  <!-- Payment Requirements Modal -->
  <%= render 'shared/payment_requirements_modal' %>
</div>