<%# app/views/forms/_lead_routing_status.html.erb %>
<%# Displays lead scoring and routing status for a form response %>

<div class="bg-white shadow rounded-lg p-4 mb-4 border-l-4 border-l-<%= lead_routing.priority_color %>"
     id="lead_routing_<%= lead_routing.id %>">
  
  <div class="flex items-center justify-between mb-3">
    <div class="flex items-center">
      <div class="flex-shrink-0">
        <% case lead_routing.priority %>
        <% when 'critical' %>
          <svg class="w-6 h-6 text-red-500" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
          </svg>
        <% when 'high' %>
          <svg class="w-6 h-6 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
          </svg>
        <% when 'medium' %>
          <svg class="w-6 h-6 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
          </svg>
        <% else %>
          <svg class="w-6 h-6 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
          </svg>
        <% end %>
      </div>
      <div class="ml-3">
        <h3 class="text-lg font-medium text-gray-900">
          Lead Score: <%= score.round %> / 100
          <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-<%= lead_routing.priority_color %>-100 text-<%= lead_routing.priority_color %>-800">
            <%= lead_tier.humanize %> Lead
          </span>
        </h3>
        <p class="text-sm text-gray-500">
          <%= lead_routing.company_name %> - <%= lead_routing.respondent_name %>
        </p>
      </div>
    </div>
    
    <div class="text-sm text-gray-500">
      SLA: <%= lead_routing.sla_deadline.strftime("%b %d, %Y %H:%M") %>
    </div>
  </div>

  <!-- Status and Progress -->
  <div class="mb-4">
    <div class="flex items-center justify-between mb-2">
      <span class="text-sm font-medium text-gray-700">Routing Status</span>
      <span class="text-sm text-gray-500"><%= lead_routing.created_at.strftime("%b %d, %H:%M") %></span>
    </div>
    
    <div class="w-full bg-gray-200 rounded-full h-2">
      <% progress_percentage = case lead_routing.status
         when 'completed' then 100
         when 'processing' then 66
         when 'pending' then 33
         else 0
         end %>
      
      <div class="bg-<%= lead_routing.status_color %>-600 h-2 rounded-full" style="width: <%= progress_percentage %>"></div>
    </div>
    
    <div class="flex justify-between text-xs text-gray-500 mt-1">
      <span><%= lead_routing.status_label %></span>
      <span><%= lead_routing.sla_status.humanize %></span>
    </div>
  </div>

  <!-- Routing Actions -->
  <% if lead_routing.routing_actions_array.any? %>
    <div class="border-t pt-3">
      <h4 class="text-sm font-medium text-gray-700 mb-2">Next Actions</h4>
      <div class="space-y-2">
        <% lead_routing.routing_actions_array.each do |action| %>
          <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
            <div>
              <span class="text-sm font-medium text-gray-900">
                <%= action[:action].humanize %>
              </span>
              <span class="text-xs text-gray-500 ml-2">
                via <%= action[:channels].join(', ') %>
              </span>
            </div>
            <span class="text-xs text-gray-500">
              <%= action[:assign_to].humanize %>
            </span>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- Lead Details -->
  <% if lead_routing.lead_scoring.present? %>
    <div class="border-t pt-3 mt-3">
      <h4 class="text-sm font-medium text-gray-700 mb-2">Lead Details</h4>
      <div class="grid grid-cols-2 gap-4 text-sm">
        <div>
          <span class="text-gray-500">Respondent:</span>
          <span class="text-gray-900 ml-1"><%= lead_routing.respondent_name %></span>
        </div>
        <div>
          <span class="text-gray-500">Company:</span>
          <span class="text-gray-900 ml-1"><%= lead_routing.company_name %></span>
        </div>
        <div>
          <span class="text-gray-500">Email:</span>
          <span class="text-gray-900 ml-1"><%= lead_routing.respondent_email %></span>
        </div>
        <div>
          <span class="text-gray-500">Confidence:</span>
          <span class="text-gray-900 ml-1"><%= lead_routing.lead_scoring.confidence_percentage %>%</span>
        </div>
      </div>

      <!-- Buying Signals -->
      <% if lead_routing.lead_scoring.buying_signals_summary.any? %>
        <div class="mt-3">
          <span class="text-sm font-medium text-gray-700">Buying Signals:</span>
          <div class="flex flex-wrap gap-1 mt-1">
            <% lead_routing.lead_scoring.buying_signals_summary.each do |signal| %>
              <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                <%= signal %>
              </span>
            <% end %>
          </div>
        </div>
      <% end %>

      <!-- Next Best Action -->
      <% if lead_routing.lead_scoring.next_best_action.present? %>
        <div class="mt-3 p-3 bg-blue-50 rounded-md">
          <span class="text-sm font-medium text-blue-900">Next Best Action:</span>
          <p class="text-sm text-blue-700 mt-1"><%= lead_routing.lead_scoring.next_best_action %></p>
        </div>
      <% end %>
    </div>
  <% end %>
</div>