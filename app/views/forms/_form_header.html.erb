<%
  # Form Header Component
  # Displays form title, status, and primary actions in the form builder
%>

<div class="bg-white border-b border-gray-200 sticky top-0 z-10">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between py-4">
      
      <!-- Left Section: Form Info -->
      <div class="flex items-center space-x-4">
        <!-- Back Button -->
        <a href="<%= forms_path %>" class="p-2 text-gray-400 hover:text-gray-600 transition-colors">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
        </a>
        
        <!-- Form Title and Status -->
        <div>
          <div class="flex items-center space-x-3">
            <h1 class="text-xl font-semibold text-gray-900 truncate max-w-md">
              <%= @form.name.present? ? @form.name : "Untitled Form" %>
            </h1>
            
            <!-- Status Badge -->
            <% case @form.status %>
            <% when 'draft' %>
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                <div class="w-2 h-2 bg-gray-400 rounded-full mr-1.5"></div>
                Draft
              </span>
            <% when 'published' %>
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                <div class="w-2 h-2 bg-success rounded-full mr-1.5"></div>
                Published
              </span>
            <% when 'archived' %>
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                <div class="w-2 h-2 bg-danger rounded-full mr-1.5"></div>
                Archived
              </span>
            <% end %>
            
            <!-- AI Enhanced Badge -->
            <% if @form.ai_enhanced? %>
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
                AI Enhanced
              </span>
            <% end %>
            
            <!-- Payment Status Badge -->
            <%= render 'forms/payment_status_indicator', form: @form %>
          </div>
          
          <!-- Form Meta Info -->
          <div class="flex items-center space-x-4 mt-1 text-sm text-gray-500">
            <span><%= pluralize(@form.questions_count, 'question') %></span>
            <span>•</span>
            <span><%= pluralize(@form.form_responses.count, 'response') %></span>
            <span>•</span>
            <span>Creado: <%= @form.created_at.strftime('%d/%m/%Y') %></span>
            <span>•</span>
            <span>Last updated <%= time_ago_in_words(@form.updated_at) %> ago</span>
          </div>
        </div>
      </div>

      <!-- Right Section: Actions -->
      <div class="flex items-center space-x-3">
        
        <!-- Preview Button -->
        <a href="<%= preview_form_path(@form) %>" target="_blank" class="inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 transition-colors">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
          </svg>
          Preview
        </a>
        
        <!-- Share Button -->
        <% if @form.published? %>
          <button data-controller="clipboard" 
                  data-clipboard-text-value="<%= form_url(@form) %>"
                  data-action="click->clipboard#copy"
                  class="inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 transition-colors">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"/>
            </svg>
            Share
          </button>
        <% end %>
        
        <!-- Publish/Unpublish Button -->
        <% if @form.published? %>
          <form action="<%= unpublish_form_path(@form) %>" method="post" class="inline">
            <input type="hidden" name="_method" value="patch" />
            <button type="submit" class="inline-flex items-center px-3 py-2 border border-amber-300 text-sm font-medium rounded-lg text-amber-700 bg-amber-50 hover:bg-amber-100 transition-colors">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18 12M6 6l12 12"/>
              </svg>
              Unpublish
            </button>
          </form>
        <% else %>
          <% if @form.form_questions.any? %>
            <form action="<%= publish_form_path(@form) %>" method="post" class="inline">
              <input type="hidden" name="_method" value="patch" />
              <button type="submit" class="inline-flex items-center px-4 py-2 bg-ai-gradient text-white text-sm font-medium rounded-lg hover:opacity-90 transition-opacity shadow-sm">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                </svg>
                Publish
              </button>
            </form>
          <% else %>
            <div class="relative group">
              <button disabled class="inline-flex items-center px-4 py-2 bg-gray-300 text-gray-500 text-sm font-medium rounded-lg cursor-not-allowed">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                </svg>
                Publish
              </button>
              <!-- Tooltip -->
              <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">
                Add questions to publish this form
                <div class="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"></div>
              </div>
            </div>
          <% end %>
        <% end %>
        
        <!-- More Actions Dropdown -->
        <div class="relative" data-controller="dropdown">
          <button data-action="click->dropdown#toggle" 
                  class="p-2 text-gray-400 hover:text-gray-600 transition-colors">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
              <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"/>
            </svg>
          </button>
          
          <div data-dropdown-target="menu" 
               class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-20">
            <div class="py-1">
              <%= link_to "Duplicate Form", "#", 
                  class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50" %>
              <%= link_to "Export Data", "#", 
                  class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50" %>
              <%= link_to "Form Settings", "#", 
                  class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50" %>
              <hr class="my-1">
              <%= button_to "Delete Form", form_path(@form), 
                  method: :delete,
                  form: { data: { turbo_confirm: "Are you sure you want to delete this form? All questions and responses will be permanently removed. This action cannot be undone." } },
                  class: "block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 bg-transparent border-0 cursor-pointer" %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Auto-save Indicator -->
<div id="autosave-indicator" class="hidden fixed top-20 right-4 z-50">
  <div class="bg-white border border-gray-200 rounded-lg shadow-lg px-3 py-2 flex items-center space-x-2">
    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
    <span class="text-sm text-gray-700">Saving...</span>
  </div>
</div>

<style>
  .bg-ai-gradient {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }
</style>