<!DOCTYPE html>
<html lang="es" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgentForm - Workflow Configuration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        @keyframes flow { 0% { background-position: 0 0; } 100% { background-position: -20px 0; } }
        
        .animate-slide-in { animation: slideIn 0.5s ease-out; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        .animate-pulse-slow { animation: pulse 2s ease-in-out infinite; }
        
        .ai-gradient { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .ai-glow { box-shadow: 0 0 20px rgba(102, 126, 234, 0.3); }
        
        .workflow-node {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .workflow-node:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .workflow-node.selected {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }
        
        .workflow-connection {
            position: absolute;
            height: 2px;
            z-index: -1;
            background-color: #d1d5db; /* gray-300 */
        }
        .workflow-connection.active {
            background: linear-gradient(90deg, #667eea, #764ba2, #667eea);
            background-size: 20px 2px;
            animation: flow 1s linear infinite;
        }

        .workflow-connection-arrow {
            position: absolute;
            right: -1px;
            top: -3px;
            width: 0;
            height: 0;
            border-left: 8px solid #667eea;
            border-top: 4px solid transparent;
            border-bottom: 4px solid transparent;
        }
        
        .task-type-llm { border-left-color: #8b5cf6; } /* purple-500 */
        .task-type-validation { border-left-color: #10b981; } /* green-500 */
        .task-type-email { border-left-color: #f59e0b; } /* amber-500 */
        .task-type-webhook { border-left-color: #ef4444; } /* red-500 */
        .task-type-conditional { border-left-color: #6366f1; } /* indigo-500 */
        
        .drag-handle:hover { cursor: grab; }
        .drag-handle:active { cursor: grabbing; }
        
        .code-editor {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            line-height: 1.5;
            background: #1e293b; /* slate-800 */
            color: #e2e8f0; /* slate-200 */
            border-radius: 8px;
            padding: 16px;
            overflow-x: auto;
        }
        
        .ruby-keyword { color: #f472b6; } /* pink-400 */
        .ruby-method { color: #60a5fa; } /* blue-400 */
        .ruby-string { color: #34d399; } /* green-400 */
        .ruby-comment { color: #94a3b8; font-style: italic; } /* slate-400 */
        .ruby-symbol { color: #a78bfa; } /* violet-400 */
        .ruby-constant { color: #fb923c; } /* orange-400 */
    </style>
</head>
<body class="bg-gray-100 h-full">
    <!-- Main Layout -->
    <div class="h-screen flex">
        
        <!-- Sidebar -->
        <nav class="w-64 bg-white border-r border-gray-200 overflow-y-auto">
            <div class="p-6">
                <!-- Brand -->
                <div class="flex items-center space-x-3 mb-8">
                    <div class="w-10 h-10 ai-gradient rounded-xl flex items-center justify-center ai-glow">
                        <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900">AgentForm</h1>
                        <p class="text-xs text-gray-500">Workflow Designer</p>
                    </div>
                </div>
                
                <!-- Task Palette -->
                <div>
                    <h3 class="text-sm font-semibold text-gray-900 mb-4">SuperAgent Tasks</h3>
                    <div class="space-y-2">
                        <!-- LLM Task -->
                        <div class="p-3 border border-gray-200 rounded-lg cursor-grab hover:bg-gray-50" draggable="true" data-task-type="llm">
                            <div class="flex items-center space-x-2">
                                <div class="w-6 h-6 bg-purple-100 rounded flex items-center justify-center">
                                    <svg class="w-3 h-3 text-purple-600" fill="currentColor" viewBox="0 0 20 20"><path d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z"/></svg>
                                </div>
                                <div>
                                    <p class="text-xs font-medium text-gray-900">LLM Task</p>
                                    <p class="text-xs text-gray-500">AI processing</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Validation Task -->
                        <div class="p-3 border border-gray-200 rounded-lg cursor-grab hover:bg-gray-50" draggable="true" data-task-type="validation">
                            <div class="flex items-center space-x-2">
                                <div class="w-6 h-6 bg-green-100 rounded flex items-center justify-center">
                                    <svg class="w-3 h-3 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                </div>
                                <div>
                                    <p class="text-xs font-medium text-gray-900">Validate</p>
                                    <p class="text-xs text-gray-500">Data validation</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Email Task -->
                        <div class="p-3 border border-gray-200 rounded-lg cursor-grab hover:bg-gray-50" draggable="true" data-task-type="email">
                            <div class="flex items-center space-x-2">
                                <div class="w-6 h-6 bg-yellow-100 rounded flex items-center justify-center">
                                    <svg class="w-3 h-3 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                                </div>
                                <div>
                                    <p class="text-xs font-medium text-gray-900">Email</p>
                                    <p class="text-xs text-gray-500">Send notification</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Webhook Task -->
                        <div class="p-3 border border-gray-200 rounded-lg cursor-grab hover:bg-gray-50" draggable="true" data-task-type="webhook">
                            <div class="flex items-center space-x-2">
                                <div class="w-6 h-6 bg-red-100 rounded flex items-center justify-center">
                                    <svg class="w-3 h-3 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/></svg>
                                </div>
                                <div>
                                    <p class="text-xs font-medium text-gray-900">Webhook</p>
                                    <p class="text-xs text-gray-500">External API</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Conditional Task -->
                        <div class="p-3 border border-gray-200 rounded-lg cursor-grab hover:bg-gray-50" draggable="true" data-task-type="conditional">
                            <div class="flex items-center space-x-2">
                                <div class="w-6 h-6 bg-indigo-100 rounded flex items-center justify-center">
                                    <svg class="w-3 h-3 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                </div>
                                <div>
                                    <p class="text-xs font-medium text-gray-900">Conditional</p>
                                    <p class="text-xs text-gray-500">If/then logic</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
        
        <!-- Main Content -->
        <div class="flex-1 flex flex-col">
            <!-- Header -->
            <header class="bg-white border-b border-gray-200 px-6 py-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">Lead Qualification Workflow</h1>
                        <p class="text-gray-600">Dise√±a y configura tu workflow de SuperAgent</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse-slow"></div>
                            <span class="text-sm text-gray-600">Auto-guardado hace 2 min</span>
                        </div>
                        
                        <button class="px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50">
                            Probar Workflow
                        </button>
                        <button class="px-4 py-2 ai-gradient text-white rounded-lg hover:opacity-90">
                            Desplegar
                        </button>
                    </div>
                </div>
            </header>
            
            <!-- Workflow Canvas -->
            <div class="flex-1 flex">
                <!-- Visual Workflow Designer -->
                <div class="flex-1 p-6 bg-gray-50 overflow-auto relative" id="workflow-canvas">
                    <!-- Nodes -->
                    <div id="node-1" class="workflow-node absolute bg-white rounded-xl p-4 border-2 border-green-500 shadow-sm" style="top: 50px; left: 100px;">
                        <div class="flex items-center space-x-3"><div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center"><svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg></div><div><h3 class="text-sm font-semibold text-gray-900">Form Start</h3><p class="text-xs text-gray-500">User begins form</p></div></div>
                    </div>
                    
                    <div id="node-2" class="workflow-node absolute bg-white rounded-xl p-4 border-2 border-l-4 task-type-validation border-gray-200 shadow-sm" style="top: 50px; left: 380px;" data-task-id="validate_input">
                        <div class="flex items-center justify-between"><div class="flex items-center space-x-3"><div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center"><svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg></div><div><h3 class="text-sm font-semibold text-gray-900">validate :basic_info</h3><p class="text-xs text-gray-500">Email & company validation</p></div></div><div class="drag-handle text-gray-400 hover:text-gray-600"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"/></svg></div></div>
                    </div>
                    
                    <div id="node-3" class="workflow-node absolute bg-white rounded-xl p-4 border-2 border-l-4 task-type-llm border-gray-200 shadow-sm selected" style="top: 50px; left: 680px;" data-task-id="llm_analysis">
                        <div class="flex items-center justify-between"><div class="flex items-center space-x-3"><div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center"><svg class="w-4 h-4 text-purple-600" fill="currentColor" viewBox="0 0 20 20"><path d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z"/></svg></div><div><h3 class="text-sm font-semibold text-gray-900">llm :analyze_lead</h3><p class="text-xs text-gray-500">Score & categorize lead</p></div></div><div class="drag-handle text-gray-400 hover:text-gray-600"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"/></svg></div></div>
                    </div>

                    <div id="node-4" class="workflow-node absolute bg-white rounded-xl p-4 border-2 border-l-4 task-type-conditional border-gray-200 shadow-sm" style="top: 180px; left: 680px;" data-task-id="conditional_split">
                        <div class="flex items-center justify-between"><div class="flex items-center space-x-3"><div class="w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center"><svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg></div><div><h3 class="text-sm font-semibold text-gray-900">if lead_score > 80</h3><p class="text-xs text-gray-500">Conditional Branch</p></div></div><div class="drag-handle text-gray-400 hover:text-gray-600"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"/></svg></div></div>
                    </div>

                    <div id="node-5" class="workflow-node absolute bg-white rounded-xl p-4 border-2 border-l-4 task-type-email border-gray-200 shadow-sm" style="top: 300px; left: 530px;" data-task-id="email_high_value">
                        <div class="flex items-center justify-between"><div class="flex items-center space-x-3"><div class="w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center"><svg class="w-4 h-4 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg></div><div><h3 class="text-sm font-semibold text-gray-900">email :notify_sales</h3><p class="text-xs text-gray-500">Alert sales team</p></div></div><div class="drag-handle text-gray-400 hover:text-gray-600"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"/></svg></div></div>
                    </div>

                    <div id="node-6" class="workflow-node absolute bg-white rounded-xl p-4 border-2 border-l-4 task-type-webhook border-gray-200 shadow-sm" style="top: 300px; left: 830px;" data-task-id="webhook_low_value">
                        <div class="flex items-center justify-between"><div class="flex items-center space-x-3"><div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center"><svg class="w-4 h-4 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/></svg></div><div><h3 class="text-sm font-semibold text-gray-900">webhook :add_to_nurture</h3><p class="text-xs text-gray-500">Add to Mailchimp</p></div></div><div class="drag-handle text-gray-400 hover:text-gray-600"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"/></svg></div></div>
                    </div>

                     <div id="node-7" class="workflow-node absolute bg-white rounded-xl p-4 border-2 border-red-500 shadow-sm" style="top: 450px; left: 680px;">
                        <div class="flex items-center space-x-3"><div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center"><svg class="w-4 h-4 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></div><div><h3 class="text-sm font-semibold text-gray-900">Workflow Complete</h3><p class="text-xs text-gray-500">Form processing done</p></div></div>
                    </div>

                    <!-- SVG container for connections -->
                    <svg id="connections-svg" class="absolute top-0 left-0 w-full h-full" style="pointer-events: none; z-index: -1;">
                        <!-- Connections will be drawn here by JS -->
                    </svg>
                </div>
                
                <!-- Properties Panel -->
                <div class="w-96 bg-white border-l border-gray-200 overflow-y-auto" id="properties-panel">
                     <div class="p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold text-gray-900">Task Properties</h3>
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-purple-500 rounded-full animate-pulse-slow"></div>
                                <span class="text-xs text-purple-600">llm :analyze_lead</span>
                            </div>
                        </div>
                        
                        <div class="space-y-6">
                            <div>
                                <h4 class="text-sm font-semibold text-gray-900 mb-3">Basic Configuration</h4>
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-1">Task Name</label>
                                        <input type="text" value="analyze_lead" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-1">Input Fields</label>
                                        <input type="text" value="basic_info, challenge_response" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="text-sm font-semibold text-gray-900 mb-3">LLM Configuration</h4>
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-1">Model</label>
                                        <select class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                            <option selected>gpt-4o-mini</option>
                                            <option>gpt-4o</option>
                                            <option>claude-3-5-sonnet</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-1">Temperature</label>
                                        <input type="range" min="0" max="1" step="0.1" value="0.3" class="w-full">
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="text-sm font-semibold text-gray-900 mb-3">Prompt Template</h4>
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-1">System Prompt</label>
                                        <textarea rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent">You are an expert lead qualification analyst specializing in B2B software sales. Analyze the provided information and score the lead quality from 1-10.</textarea>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-1">User Prompt</label>
                                        <textarea rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent">Analyze this lead: Contact: {{basic_info.email}}, Company: {{basic_info.company}}. Provide JSON with: score (1-10), category (hot/warm/cold), reasoning.</textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-8">
                            <h4 class="text-sm font-semibold text-gray-900 mb-3">Generated SuperAgent Code</h4>
                            <div class="code-editor">
<pre><code><span class="ruby-comment"># Lead analysis task with AI scoring</span>
<span class="ruby-keyword">llm</span> <span class="ruby-symbol">:analyze_lead</span> <span class="ruby-keyword">do</span>
  <span class="ruby-method">input</span> <span class="ruby-symbol">:basic_info</span>, <span class="ruby-symbol">:challenge_response</span>
  
  <span class="ruby-method">model</span> <span class="ruby-string">"gpt-4o-mini"</span>
  <span class="ruby-method">temperature</span> <span class="ruby-constant">0.3</span>
  <span class="ruby-method">response_format</span> <span class="ruby-symbol">:json</span>
  
  <span class="ruby-method">system_prompt</span> <span class="ruby-string">"You are an expert..."</span>
  <span class="ruby-method">prompt</span> <span class="ruby-string">"""Analyze this lead..."""</span>
  
  <span class="ruby-method">retry_policy</span> <span class="ruby-symbol">max_retries:</span> <span class="ruby-constant">3</span>
  <span class="ruby-method">timeout</span> <span class="ruby-constant">30</span>
<span class="ruby-keyword">end</span></code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const connections = [
            { from: 'node-1', to: 'node-2', active: true },
            { from: 'node-2', to: 'node-3', active: true },
            { from: 'node-3', to: 'node-4', active: true },
            { from: 'node-4', to: 'node-5', active: true, label: 'True' },
            { from: 'node-4', to: 'node-6', active: false, label: 'False' },
            { from: 'node-5', to: 'node-7', active: true },
            { from: 'node-6', to: 'node-7', active: false }
        ];

        const svg = document.getElementById('connections-svg');

        function drawConnections() {
            svg.innerHTML = ''; // Clear existing lines

            connections.forEach(conn => {
                const fromNode = document.getElementById(conn.from);
                const toNode = document.getElementById(conn.to);

                if (!fromNode || !toNode) return;

                const fromRect = fromNode.getBoundingClientRect();
                const toRect = toNode.getBoundingClientRect();
                const canvasRect = svg.getBoundingClientRect();

                const startX = fromRect.right - canvasRect.left + 5;
                const startY = fromRect.top - canvasRect.top + fromRect.height / 2;
                const endX = toRect.left - canvasRect.left - 5;
                const endY = toRect.top - canvasRect.top + toRect.height / 2;
                
                const midX = startX + (endX - startX) / 2;

                // Create a simple curved path (SVG path)
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                const d = `M ${startX} ${startY} C ${midX} ${startY}, ${midX} ${endY}, ${endX} ${endY}`;
                path.setAttribute('d', d);
                path.setAttribute('stroke', conn.active ? '#667eea' : '#d1d5db');
                path.setAttribute('stroke-width', '2');
                path.setAttribute('fill', 'none');
                
                if (conn.active) {
                    path.setAttribute('stroke-dasharray', '5, 5');
                    const animate = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
                    animate.setAttribute('attributeName', 'stroke-dashoffset');
                    animate.setAttribute('from', '0');
                    animate.setAttribute('to', '20');
                    animate.setAttribute('dur', '1s');
                    animate.setAttribute('repeatCount', 'indefinite');
                    path.appendChild(animate);
                }

                svg.appendChild(path);
            });
        }
        
        // Initial draw
        drawConnections();

        // Redraw on window resize
        window.addEventListener('resize', drawConnections);
    });
    </script>
</body>
</html>
